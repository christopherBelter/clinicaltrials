setwd("H:/Bibliometrics/My Publications/CT.gov")
source("H:/Bibliometrics/R/Functions/getClinicalTrials.r")
allStudies <- getCT(sStartBegin = "01/01/2013", sStartEnd = "12/31/2017", outfile = "allStudies.xml")
allStudies <- extractCT(allStudies)
write.csv(allStudies, file = "allStudies.csv")
STypes <- sapply(split(allStudies, allStudies$studyType), nrow)
STypes
write.csv(STypes, file = "studiesPerStudyType.csv")
library(plyr)
intervTypes <- count(unlist(strsplit(allStudies$interventionTypes, "|", fixed = TRUE)))
intervTypes$perc <- intervTypes[,2] / nrow(allStudies)
write.csv(intervTypes, file = "studiesPerIntervType.csv", row.names = FALSE)
phases <- count(unlist(strsplit(allStudies$phases, "|", fixed = TRUE)))
phases$perc <- phases[,2] / nrow(allStudies)
phases
write.csv(phases, file = "studiesPerPhase.csv", row.names = FALSE)
sDesigns <- count(unlist(strsplit(allStudies$studyDesigns, "|", fixed = TRUE)))
sDesigns$perc <- sDesigns[,2] / nrow(allStudies)
write.csv(sDesigns, file = "studiesPerStudyDesign.csv", row.names = FALSE)
sFunders <- count(unlist(strsplit(allStudies$funders, "|", fixed = TRUE)))
sFunders$perc <- sFunders[,2] / nrow(allStudies)
sFunders
write.csv(sFunders, file = "studiesPerFunderType.csv", row.names = FALSE)
lSpons <- sapply(split(allStudies, allStudies$leadSponsor), nrow)
lSpons <- sort(lSpons)
tail(lSpons, 10)
write.csv(lSpons, file = "studiesPerLeadSponsor.csv")
sEnroll <- quantile(allStudies$enrollment, na.rm = TRUE)
sEnroll
write.csv(sEnroll, file = "enrollmentQuartiles.csv")
sGender <- count(unlist(strsplit(allStudies$gender, "|", fixed = TRUE)))
sGender$perc <- sGender[,2] / nrow(allStudies)
sGender
write.csv(sGender, file = "studiesPerGender.csv")
sAge <- count(unlist(strsplit(allStudies$ageGroups, "|", fixed = TRUE)))
sAge$perc <- sAge[,2] / nrow(allStudies)
sAge
write.csv(sAge, file = "studiesPerAgeGroup.csv")
sResults <- sapply(split(allStudies, allStudies$studyResults), nrow)
sResults
write.csv(sResults, file = "studiesByHasResults.csv")
sRecruit <- sapply(split(allStudies, allStudies$recruitment), nrow)
sRecruit
write.csv(sRecruit, file = "studiesByRecruitmentStatus.csv")
library(splitstackshape)
library(data.table)
intervs <- cSplit(allStudies, "interventionTypes", "|", direction = "long")
intervPhase <- count(intervs, vars = c("interventionTypes", "phases"))
intervPhase <- cSplit(intervPhase, "phases", "|", direction = "long")
intervPhase <- dcast(intervPhase, interventionTypes ~ phases, fun.aggregate = sum, value.var = "freq")
write.csv(intervPhase, file = "interventionByPhase.csv", row.names = FALSE)
intervFund <- count(intervs, vars = c("interventionTypes", "funders"))
intervFund <- cSplit(intervFund, "funders", "|", direction = "long")
intervFund <- dcast(intervFund, interventionTypes ~ funders, fun.aggregate = sum, value.var = "freq")
write.csv(intervFund, file = "interventionByFunder.csv", row.names = FALSE)
intervDesign <- count(intervs, vars = c("interventionTypes", "studyDesigns"))
intervDesign <- cSplit(intervDesign, "studyDesigns", "|", direction = "long")
intervDesign <- dcast(intervDesign, studyDesigns ~ interventionTypes, fun.aggregate = sum, value.var = "freq")
write.csv(intervDesign, file = "interventionByStudyDesign.csv", row.names = FALSE)
intervEnroll <- sapply(split(intervs$enrollment, intervs$interventionTypes), quantile, na.rm = TRUE)
write.csv(t(intervEnroll), file = "interventionByEnrollmentQuantile.csv")
phases <- cSplit(allStudies, "phases", "|", direction = "long")
phaseEnroll <- sapply(split(phases$enrollment, phases$phases), quantile, na.rm = TRUE)
write.csv(phaseEnroll, file = "enrollmentByPhase.csv")
phaseByFund <- count(phases, vars = c("phases", "funders"))
phaseByFund <- cSplit(phaseByFund, "funders", "|", direction = "long")
phaseByFund <- dcast(phaseByFund, funders ~ phases, fun.aggregate = sum, value.var = "freq")
write.csv(phaseByFund, file = "fundingByPhase.csv", row.names = FALSE)
library(ggplot2)
blindDesign <- intervDesign[grepl("Masking:", intervDesign$studyDesigns),]
blindDesign <- melt(blindDesign, id.vars = "studyDesigns")
blindDesign$studyDesigns <- gsub(" \\(.+\\)", "", blindDesign$studyDesigns)
blindDesign$studyDesigns <- gsub("Masking:", "", blindDesign$studyDesigns)
blindDesign <- dcast(blindDesign, variable ~ studyDesigns, value.var = "value", fun.aggregate = sum)
blindDesign <- blindDesign[,c(1,4,6,2,5,3)]
write.csv(blindDesign, file = "studiesPerBlindingPerStudyDesign.csv", row.names = FALSE)
blindDesign <- melt(blindDesign, id.vars = "variable")
intvTypes <- sort(levels(intervs$interventionTypes), decreasing = TRUE)
p1 <- ggplot(blindDesign, aes(fill = variable.1, y = value, x = variable)) + geom_bar(stat = "identity", position = "fill", na.rm = TRUE) + theme(legend.position = "top", text = element_text(size=15)) + labs(y = "Percent of studies", x = NULL, fill = "Blinding method:")
p1 + scale_x_discrete(limits = intvTypes) + scale_y_continuous(labels = scales::percent) + scale_fill_brewer(palette = "Dark2") + guides(col = guide_legend(reverse = TRUE), fill = guide_legend(reverse = TRUE)) + coord_flip()
p2 <- ggplot(intervs, aes(interventionTypes, enrollment)) + geom_boxplot(fill = "#deebf7", colour = "#08306b", outlier.shape = NA) + coord_cartesian(ylim = c(0,400)) + labs(y = "Enrollment", x = NULL) + theme(text = element_text(size=15))
p2 + scale_x_discrete(limits = intvTypes) + coord_flip(ylim = c(0,400))
phaseNames <- c("Not Applicable", "Phase 4", "Phase 3", "Phase 2", "Phase 1", "Early Phase 1")
p3 <- ggplot(phases, aes(phases, enrollment)) + geom_boxplot(fill = "#deebf7", colour = "#08306b", outlier.shape = NA) + coord_cartesian(ylim = c(0,500)) + labs(y = "Enrollment", x = NULL) + theme(text = element_text(size=15))
p3 + scale_x_discrete(limits = phaseNames) + coord_flip(ylim = c(0,500))
intervFund <- melt(intervFund, id.vars = "interventionTypes")
p4 <- ggplot(intervFund, aes(fill = reorder(intervFund$variable, intervFund$value, sum), y = value, x = interventionTypes)) + geom_bar(stat = "identity", position = "fill", na.rm = TRUE) + theme(legend.position = "top", text = element_text(size=15)) + labs(y = "Percent of studies", x = NULL, fill = "Funding source:")
p4 + scale_x_discrete(limits = intvTypes) + scale_y_continuous(labels = scales::percent) + scale_fill_brewer(palette = "Dark2", direction = -1) + guides(col = guide_legend(reverse = TRUE), fill = guide_legend(reverse = TRUE)) + coord_flip()
blindPhase <- count(phases, vars = c("phases", "studyDesigns"))
blindPhase <- cSplit(blindPhase, "studyDesigns", "|", direction = "long")
blindPhase <- dcast(blindPhase, studyDesigns ~ phases, fun.aggregate = sum, value.var = "freq")
write.csv(blindPhase, file = "studyDesignByPhase.csv", row.names = FALSE)
blindPhase <- blindPhase[grepl("Masking:", blindPhase$studyDesigns),]
blindPhase <- melt(blindPhase, id.vars = "studyDesigns")
blindPhase$studyDesigns <- gsub(" \\(.+\\)", "", blindPhase$studyDesigns)
blindPhase$studyDesigns <- gsub("Masking:", "", blindPhase$studyDesigns)
blindPhase <- dcast(blindPhase, variable ~ studyDesigns, value.var = "value", fun.aggregate = sum)
blindPhase <- blindPhase[,c(1,4,6,2,5,3)]
write.csv(blindPhase, file = "blindingByPhase.csv", row.names = FALSE)
blindPhase <- melt(blindPhase, id.vars = "variable")
p5 <- ggplot(blindPhase, aes(fill = variable.1, y = value, x = variable)) + geom_bar(stat = "identity", position = "fill", na.rm = TRUE) + theme(legend.position = "top", text = element_text(size=15)) + labs(y = "Percent of studies", x = NULL, fill = "Blinding method:")
p5 + scale_x_discrete(limits = phaseNames) + scale_y_continuous(labels = scales::percent) + scale_fill_brewer(palette = "Dark2") + guides(col = guide_legend(reverse = TRUE), fill = guide_legend(reverse = TRUE)) + coord_flip()
funds <- cSplit(allStudies, "funders", "|", direction = "long")
fundEnroll <- funds[,c(17,16)]
fundEnroll <- sapply(split(fundEnroll$enrollment, fundEnroll$funders), quantile, na.rm = TRUE)
fundEnroll
write.csv(fundEnroll, file = "enrollmentByFunder.csv")
fundPhase <- count(funds, vars = c("phases", "funders"))
fundPhase <- cSplit(fundPhase, "phases", "|", direction = "long")
fundPhase <- dcast(fundPhase, phases ~ funders, fun.aggregate = sum, value.var = "freq")
write.csv(fundPhase, file = "studiesPerFunderPerPhase.csv", row.names = FALSE)
fundPhase <- melt(fundPhase, id.vars = "phases")
p6 <- ggplot(fundPhase, aes(fill = reorder(fundPhase$variable, fundPhase$value, sum), y = value, x = phases)) + geom_bar(stat = "identity", position = "fill", na.rm = TRUE) + theme(legend.position = "top", text = element_text(size=15)) + labs(y = "Percent of studies", x = NULL, fill = "Funding source:")
p6 + scale_x_discrete(limits = phaseNames) + scale_y_continuous(labels = scales::percent) + scale_fill_brewer(palette = "Dark2", direction = -1) + guides(col = guide_legend(reverse = TRUE), fill = guide_legend(reverse = TRUE)) + coord_flip()
p7 <- ggplot(fundPhase, aes(fill = factor(phases, levels = phaseNames), y = value, x = variable)) + geom_bar(stat = "identity", position = "fill") + theme(legend.position = "top", text = element_text(size=15)) + labs(y = "Percent of studies", x = NULL, fill = "Phase:")
p7 + scale_x_discrete(limits = sort(levels(fundPhase$variable), decreasing = TRUE)) + scale_y_continuous(labels = scales::percent) + scale_fill_brewer(palette = "Dark2") + guides(col = guide_legend(reverse = TRUE), fill = guide_legend(reverse = TRUE)) + coord_flip()
p8 <- ggplot(funds, aes(funders, enrollment)) + geom_boxplot(fill = "#deebf7", colour = "#08306b", outlier.shape = NA) + coord_cartesian(ylim = c(0,400)) + labs(y = "Enrollment", x = NULL) + theme(text = element_text(size=15))
p8 + scale_x_discrete(limits = sort(levels(funds$funders), decreasing = TRUE)) + coord_flip(ylim = c(0,400))
isMulti <- sapply(split(allStudies, allStudies$isMulti), nrow)
write.csv(isMulti, file = "studiesPerMultiLocation.csv")
summary(allStudies$isMulti)
enrZero <- allStudies[allStudies$enrollment == 0,]